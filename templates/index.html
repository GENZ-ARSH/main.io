{% extends 'base.html' %}

{% block title %}GEN-Z LIBRARY - The Ultimate Knowledge Hub{% endblock %}

{% block content %}
<div class="container mx-auto">
    <!-- Hero Section -->
    <section class="relative rounded-lg overflow-hidden mb-16">
        <div class="bg-gradient-to-r from-indigo-600 to-purple-600 h-96 flex items-center">
            <div class="container mx-auto px-6 md:px-12 relative z-10">
                <div class="max-w-xl">
                    <h1 class="text-4xl md:text-5xl font-bold text-white leading-tight mb-4">
                        ‚ö° GEN-Z LIBRARY
                    </h1>
                    <p class="text-xl text-white opacity-90 mb-8">
                        Your central vault of educational power. Free books, notes, and study materials for Classes 9-12, JEE, NEET, NDA, and more!
                    </p>
                    <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                        <a href="#categories" class="px-6 py-3 bg-white text-indigo-600 font-medium rounded-md shadow-md hover:bg-gray-50 transition-colors text-center">
                            Explore Categories
                        </a>
                        {% if not session.get('user_id') %}
                        <a href="{{ url_for('register') }}" class="px-6 py-3 bg-transparent border-2 border-white text-white font-medium rounded-md hover:bg-white hover:bg-opacity-20 transition-colors text-center">
                            Join GEN-Z CLAN
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <div class="absolute inset-0 bg-black opacity-10"></div>
    </section>
    
    <!-- Features Section -->
    <section class="mb-16">
        <div class="text-center mb-10">
            <h2 class="text-3xl font-bold mb-3">üåü Main Features</h2>
            <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
                Designed for the new wave of students, providing everything you need for academic success.
            </p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="card p-6 rounded-lg">
                <div class="text-indigo-600 mb-4">
                    <i class="fas fa-book text-3xl"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">üìö Class-Wise Books</h3>
                <p class="text-gray-600 dark:text-gray-400">
                    Categorized resources for Classes 9-12 and competitive exams like JEE, NEET, and NDA.
                </p>
            </div>
            
            <div class="card p-6 rounded-lg">
                <div class="text-indigo-600 mb-4">
                    <i class="fas fa-search text-3xl"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">üîç Search & Filter</h3>
                <p class="text-gray-600 dark:text-gray-400">
                    Easily find materials by title, subject, or tags without hassle.
                </p>
            </div>
            
            <div class="card p-6 rounded-lg">
                <div class="text-indigo-600 mb-4">
                    <i class="fas fa-bolt text-3xl"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">‚ö° Realtime Updates</h3>
                <p class="text-gray-600 dark:text-gray-400">
                    Get the latest books and resources as soon as they're available.
                </p>
            </div>
            
            <div class="card p-6 rounded-lg">
                <div class="text-indigo-600 mb-4">
                    <i class="fas fa-moon text-3xl"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">üåë Dark/Light Mode</h3>
                <p class="text-gray-600 dark:text-gray-400">
                    Switch between themes to reduce eye strain while studying day or night.
                </p>
            </div>
            
            <div class="card p-6 rounded-lg">
                <div class="text-indigo-600 mb-4">
                    <i class="fas fa-bullhorn text-3xl"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">üì¢ Announcements</h3>
                <p class="text-gray-600 dark:text-gray-400">
                    Stay updated with the latest announcements from our GENZ team.
                </p>
                <div class="mt-4">
                    <a href="{{ url_for('announcements') }}" class="btn-primary py-2 px-4 rounded-md inline-flex items-center">
                        <i class="fas fa-arrow-right mr-1"></i> View
                    </a>
                </div>
            </div>
            
            <div class="card p-6 rounded-lg">
                <div class="text-indigo-600 mb-4">
                    <i class="fas fa-envelope text-3xl"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">üì© Book Requests</h3>
                <p class="text-gray-600 dark:text-gray-400">
                    Can't find what you need? Request books and we'll add them to our library.
                </p>
                <div class="mt-4">
                    <a href="{{ url_for('request_book') }}" class="btn-primary py-2 px-4 rounded-md inline-flex items-center">
                        <i class="fas fa-arrow-right mr-1"></i> Request
                    </a>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Admin Access Section -->
    <section class="mb-16">
        <div class="text-center mb-10">
            <h2 class="text-3xl font-bold mb-3">üõ°Ô∏è Admin Dashboard</h2>
            <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
                Administrative area for GEN-Z LIBRARY management. Access requires the GENZCLANX code.
            </p>
        </div>
        
        <div class="max-w-2xl mx-auto">
            <div class="card p-8 rounded-lg border-2 border-indigo-500/40 relative overflow-hidden group">
                <!-- Corner decoration -->
                <div class="absolute top-0 right-0 w-16 h-16 overflow-hidden">
                    <div class="bg-indigo-500 rotate-45 transform origin-bottom-right w-22 h-22 absolute -right-3 -top-8"></div>
                    <i class="fas fa-lock text-white absolute right-2 top-2 z-10"></i>
                </div>
                
                <div class="text-center">
                    <div class="text-indigo-600 mb-6 inline-block">
                        <div class="relative">
                            <i class="fas fa-user-shield text-5xl"></i>
                            <div class="absolute h-full w-full top-0 rounded-full border-4 border-indigo-300 animate-ping opacity-30"></div>
                        </div>
                    </div>
                    <h3 class="text-2xl font-bold mb-4">Secure Admin Console</h3>
                    <p class="text-gray-600 dark:text-gray-400 max-w-lg mx-auto mb-6">
                        Access the admin dashboard to manage books, users, requests and more. This area is protected with the GENZCLANX secret code.
                    </p>
                    <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 justify-center">
                        <button type="button" data-section="admin" class="secure-access-btn btn-primary py-3 px-8 rounded-md inline-flex items-center justify-center">
                            <i class="fas fa-key mr-2"></i> Secure Admin Access
                        </button>
                    </div>
                    
                    <div class="mt-8 flex justify-center">
                        <div class="bg-indigo-100 dark:bg-indigo-900/30 p-3 rounded-lg inline-flex items-center text-sm text-indigo-600 dark:text-indigo-300">
                            <i class="fas fa-info-circle mr-2"></i> Only authorized GENZ administrators can access this area
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Secret Access Modal -->
    <div id="secureAccessModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-md w-full transform transition-transform scale-95 opacity-0" id="secureModalContent">
            <div class="text-center mb-6">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-indigo-100 dark:bg-indigo-900 text-indigo-500 mb-4">
                    <i class="fas fa-shield-alt text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900 dark:text-white" id="secureModalTitle">Secure Access Required</h3>
                <p class="text-gray-600 dark:text-gray-400 mt-1" id="secureModalDescription">
                    Enter the GENZCLANX code to access this feature
                </p>
            </div>
            
            <form id="secureAccessForm">
                <div class="mb-4">
                    <label for="accessCode" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Access Code</label>
                    <input type="password" id="accessCode" name="accessCode" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white" placeholder="Enter GENZCLANX code" required>
                    <p id="accessError" class="text-red-500 text-sm mt-1 hidden">Invalid code. Access denied.</p>
                </div>
                
                <input type="hidden" id="requestedSection" name="requestedSection" value="">
                
                <div class="flex items-center justify-between mt-6">
                    <button type="button" id="closeModalBtn" class="text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">Cancel</button>
                    <button type="submit" class="btn-primary py-2 px-4 rounded-md">Authenticate</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- GEN-Z ANNOUNCEMENTS Section -->
    {% if announcements %}
    <section class="mb-16">
        <div class="text-center mb-10">
            <h2 class="text-3xl font-bold mb-3 flex items-center justify-center">
                <i class="fas fa-bullhorn text-indigo-500 mr-3 animate-pulse"></i>
                üì¢ GEN-Z ANNOUNCEMENTS
            </h2>
            <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
                Latest news and updates from the GEN-Z LIBRARY team.
            </p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {% for announcement in announcements %}
            <div class="card hover:shadow-lg hover:shadow-indigo-500/10 dark:hover:shadow-indigo-900/40 overflow-hidden rounded-lg transform transition hover:scale-105 duration-300 flex flex-col">
                {% if announcement.image_url %}
                <div class="h-40 overflow-hidden">
                    <img src="{{ announcement.image_url }}" alt="{{ announcement.title }}" class="w-full h-full object-cover">
                </div>
                {% else %}
                <div class="h-32 bg-gradient-to-r from-indigo-500 to-purple-500 flex items-center justify-center">
                    <i class="fas fa-bullhorn text-4xl text-white"></i>
                </div>
                {% endif %}
                
                <div class="p-5 flex-grow">
                    <h3 class="text-xl font-bold mb-2 text-indigo-600 dark:text-indigo-400">{{ announcement.title }}</h3>
                    <p class="text-gray-600 dark:text-gray-300 mb-4 line-clamp-2">
                        {{ announcement.description|truncate(100) }}
                    </p>
                </div>
                
                <div class="p-4 border-t border-gray-200 dark:border-gray-700 mt-auto flex justify-between items-center">
                    <span class="text-xs text-gray-500 dark:text-gray-400 flex items-center">
                        <i class="far fa-calendar-alt mr-1"></i>
                        {{ announcement.post_date.strftime('%b %d, %Y') }}
                    </span>
                    
                    <a href="{{ url_for('announcement_detail', announcement_id=announcement.id) }}" class="text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 text-sm">
                        Read more
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="text-center mt-8">
            <a href="{{ url_for('announcements') }}" class="inline-flex items-center px-5 py-2 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700">
                <i class="fas fa-bullhorn mr-2"></i>
                View All Announcements
            </a>
        </div>
    </section>
    {% endif %}
    
    <!-- Categories Section -->
    <section id="categories" class="mb-16">
        <div class="text-center mb-10">
            <h2 class="text-3xl font-bold mb-3">üìö Categories</h2>
            <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
                Browse our comprehensive collection of educational resources by class and exam.
            </p>
        </div>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            {% for category in categories %}
            <a href="{{ url_for('books', category=category.id) }}" class="card rounded-lg overflow-hidden transform transition hover:scale-105">
                <div class="h-40 bg-gray-200 relative">
                    <img src="{{ category.image }}" alt="{{ category.name }}" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-gradient-to-t from-black to-transparent opacity-70"></div>
                    <div class="absolute bottom-0 left-0 p-4 text-white">
                        <h3 class="text-xl font-bold">{{ category.name }}</h3>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    </section>
    
    <!-- Featured Books Section -->
    <section class="mb-16">
        <div class="text-center mb-10">
            <h2 class="text-3xl font-bold mb-3">üìñ Featured Books</h2>
            <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
                Most popular and recently added books in our library.
            </p>
        </div>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            {% for book in featured_books %}
            <div class="card rounded-lg overflow-hidden">
                <div class="h-48 bg-gray-200 relative">
                    {% if book.cover_image %}
                    <img src="{{ book.cover_image }}" alt="{{ book.title }}" class="w-full h-full object-cover">
                    {% else %}
                    <div class="w-full h-full flex items-center justify-center bg-indigo-100 dark:bg-indigo-900">
                        <i class="fas fa-book text-4xl text-indigo-500"></i>
                    </div>
                    {% endif %}
                </div>
                <div class="p-4">
                    <h3 class="text-lg font-bold mb-1 truncate">{{ book.title }}</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">by {{ book.author }}</p>
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded-full">{{ book.file_format }}</span>
                        <span class="text-xs text-gray-600 dark:text-gray-400">{{ book.file_size }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-xs text-gray-600 dark:text-gray-400">
                            <i class="fas fa-download mr-1"></i> {{ book.downloads }} downloads
                        </span>
                        <a href="{{ url_for('book_detail', book_id=book.id) }}" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">
                            View
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="text-center mt-8">
            <a href="{{ url_for('books', category='class-9') }}" class="px-6 py-3 bg-indigo-600 text-white font-medium rounded-md hover:bg-indigo-700 transition-colors inline-block">
                Browse All Books
            </a>
        </div>
    </section>
    
    <!-- Call to Action -->
    <section class="mb-16">
        <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-lg p-8 md:p-12">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="text-3xl font-bold text-white mb-4">Join the GEN-Z CLAN Today!</h2>
                <p class="text-xl text-white opacity-90 mb-8">
                    Get access to all our resources, request books, and even become an admin to help grow our library.
                </p>
                {% if not session.get('user_id') %}
                <div class="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4">
                    <a href="{{ url_for('register') }}" class="px-6 py-3 bg-white text-indigo-600 font-medium rounded-md shadow-md hover:bg-gray-50 transition-colors text-center">
                        Sign Up Now
                    </a>
                    <a href="{{ url_for('login') }}" class="px-6 py-3 bg-transparent border-2 border-white text-white font-medium rounded-md hover:bg-white hover:bg-opacity-20 transition-colors text-center">
                        Already a Member? Log In
                    </a>
                </div>
                {% else %}
                <a href="{{ url_for('request_book') }}" class="px-6 py-3 bg-white text-indigo-600 font-medium rounded-md shadow-md hover:bg-gray-50 transition-colors inline-block">
                    Request a Book
                </a>
                {% endif %}
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Dark mode toggle functionality is in darkmode.js
        
        // Secure Access Modal Functionality
        const secureAccessModal = document.getElementById('secureAccessModal');
        const secureModalContent = document.getElementById('secureModalContent');
        const secureAccessButtons = document.querySelectorAll('.secure-access-btn');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const secureAccessForm = document.getElementById('secureAccessForm');
        const requestedSectionInput = document.getElementById('requestedSection');
        const accessError = document.getElementById('accessError');
        const secureModalTitle = document.getElementById('secureModalTitle');
        const secureModalDescription = document.getElementById('secureModalDescription');
        
        // Feature names mapping
        const featureNames = {
            'admin': 'Admin Dashboard',
            'battle': 'Battle Arena',
            'internship': 'Internship Portal',
            'ai': 'AI Feature Center',
            'marketplace': 'GENZ Marketplace',
            'scheduler': 'Live Class Scheduler'
        };
        
        // Open secure access modal
        function openSecureModal(section) {
            requestedSectionInput.value = section;
            secureModalTitle.textContent = `Secure Access: ${featureNames[section] || section}`;
            secureModalDescription.textContent = `Enter the GENZCLANX code to access ${featureNames[section] || 'this feature'}`;
            
            secureAccessModal.classList.remove('hidden');
            setTimeout(() => {
                secureModalContent.classList.remove('scale-95', 'opacity-0');
                secureModalContent.classList.add('scale-100', 'opacity-100');
                document.getElementById('accessCode').focus();
            }, 10);
        }
        
        // Close secure access modal
        function closeSecureModal() {
            secureModalContent.classList.remove('scale-100', 'opacity-100');
            secureModalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                secureAccessModal.classList.add('hidden');
                secureAccessForm.reset();
                accessError.classList.add('hidden');
            }, 300);
        }
        
        // Set up event listeners for secure access buttons
        secureAccessButtons.forEach(button => {
            button.addEventListener('click', function() {
                const section = this.getAttribute('data-section');
                openSecureModal(section);
            });
        });
        
        // Close modal button
        if (closeModalBtn) {
            closeModalBtn.addEventListener('click', closeSecureModal);
        }
        
        // Close modal when clicking outside content
        secureAccessModal.addEventListener('click', function(e) {
            if (e.target === secureAccessModal) {
                closeSecureModal();
            }
        });
        
        // Handle secure access form submission
        secureAccessForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const accessCode = document.getElementById('accessCode').value;
            const section = requestedSectionInput.value;
            
            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalBtnText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-circle-notch fa-spin mr-1"></i> Verifying...';
            submitBtn.disabled = true;
            
            // Send verification request
            fetch('/verify-access', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    code: accessCode,
                    section: section
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Access granted, redirect
                    window.location.href = data.redirect;
                } else {
                    // Show error
                    accessError.classList.remove('hidden');
                    accessError.textContent = data.message || 'Invalid code. Access denied.';
                    
                    // Reset button
                    submitBtn.innerHTML = originalBtnText;
                    submitBtn.disabled = false;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                accessError.classList.remove('hidden');
                accessError.textContent = 'An error occurred. Please try again.';
                
                // Reset button
                submitBtn.innerHTML = originalBtnText;
                submitBtn.disabled = false;
            });
        });
    });
</script>
{% endblock %}
